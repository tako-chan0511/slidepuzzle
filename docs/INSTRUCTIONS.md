# パズルスライダー N×M 操作手引き

## 1. ゲーム概要

「パズルスライダー N×M」は、1枚の空きタイルを使って複数のタイルをスライドし、すべての数字を順番に並べ替えてゴールを目指すスライドパズルです。

- タイルは **行数 × 列数（N×M）** 分配置され、最後のタイルだけが「空き (ブランク)」として扱われます。
- クリック／タップしたタイルと、そのタイルと空きタイルが同じ行または同じ列にある場合、その間に挟まったタイルすべてが空き方向に一度にスライドします。
- すべてのタイルが昇順（左上から右下）に並び、最後のマスに空きタイルが来たらクリアです。

---

## 2. 初期設定

- アプリ起動時は、デフォルトで **4×4（4行×4列）** の盤面が表示されます。
- 画面上部の「行数 (Rows)」「列数 (Cols)」欄に、希望する行数・列数（**2～10** の範囲）を入力します。
- 数字を入力後、「**設定反映**」ボタンをクリックすると、新しいサイズの盤面が初期状態（1～(N×M-1) が順番に並び、最後が空きタイル）で生成されます。

> ※反映前に入力を変えても盤面は変わりません。必ず「設定反映」を押してから盤面の操作を行ってください。

---

## 3. 盤面の見方

- 各セルには **1～(N×M−1)** の数字がランダムに配置されています。
- 最後のセルが **空きタイル (ブランク)** で、数字は表示されません（空白）。
- 盤面下部には「**盤面サイズ：N × M**」や、クリア時に「おめでとう！ 完成しました」と表示されます。

---

## 4. 操作方法

### 4.1 タイルをクリック／タップして動かす

- 同じ行または同じ列に空きタイル（ブランク）があるタイルをクリックまたはタップします。
- そのタイルと空きタイルの間に位置するすべてのタイルが、一度に空きマスの方向へスライドします。

**例：4×4盤面でのスライド**

|  1 |  2 |  3 |  □ |   ←□は空きタイル (ブランク)

↑ タイル「1」をクリックすると…

→ 1 が最右列に移動し、2→3 もすべて右へスライドします

|  □ |  1 |  2 |  3 |

- 隣接するタイル(空きと隣り合っている場合)は、通常のスワップとして1枚だけ動きます。

### 4.2 シャッフルとリセット

**シャッフル**

- 画面上部の「シャッフル」ボタンで、現在の盤面を「必ず解ける状態のランダム配置」に変更できます。
- 可解性判定アルゴリズムにより、必ず「正解にたどり着ける」シャッフル結果しか生成されません。
- 何度でもやり直し可能です。

**リセット**

- 画面上部の「リセット」ボタンで、現在の行数・列数設定に応じた「初期状態（1～N×M−1が昇順、最後が空き）」に戻せます。
- 途中でシャッフルや何回か動かしたあとでも、いつでもワンクリックでスタート状態に戻せます。

---

## 5. クリア条件

- すべてのタイル（数字）が、左上から右下まで順番に並び、最後のセルが **空きタイル (ブランク)** になっていればクリアです。

**例：3×4盤面でのクリア状態**

```
1   2   3   4
5   6   7   8
9  10  11  □
```

- クリアすると、盤面下部に「おめでとう！ 完成しました。」というメッセージが表示されます。

---

## 6. N×M 盤面での注意点

- **縦長・横長どちらでもOK**
    - 例：3行×5列や6行×4列など、自由にサイズ指定可能。
    - サイズの幅は **2 ≤ 行数, 列数 ≤ 10** の範囲で設定してください。

- **セルが完全に揃う表示のコツ**
    - タイルの中に「空き（値0）」があるときは `visibility: hidden;` のみを適用し、セル自体を消さない設計です。
    - 最後の行に1枚分の空きセルがあっても、グリッド自体のサイズは維持され、ズレません。

- **可解性（解ける配置）について**
    - シャッフル時に「裏返しに並べても解けるか（inversion の偶奇）」を判定しているため、必ず1回のシャッフルで解法が存在します。
    - 手詰まりに感じたら「シャッフル」を押してやり直してください。

---

## 7. トラブルシューティング

- **タイルが重なって表示される／ズレる**
    - ブラウザの表示幅に対して盤面が大きすぎるとセルのサイズが縮小し、数字がつぶれることがあります。
    - 画面サイズに合わせて最大幅を設定している場合があるため、ブラウザ幅を広げるか、行数・列数を小さくして再設定してください。

- **シャッフルしてもタイルが動かない**
    - クリックしたタイルと空きタイルが「同じ行・同じ列」かをチェックし、動かせないケースでは反応しません。
    - 別のタイルをクリックするか、同じ行／列で確実に隙間があるタイルを選択してください。

- **行数・列数を変更しても盤面が変化しない**
    - 行数・列数を編集しただけでは反映されず、必ず「設定反映」ボタンを押す必要があります。
    - 入力後にエラーメッセージ（赤字）が出ていないか確認し、正しい範囲（2～10）の数値であることを確かめてください。

---

## 8. 遊び方のポイント

- **まとめてスライドさせるテクニック**
    - 1枚ずつ動かすより、行全体を一気にスライドさせると手数が減ります。
    - 空きタイルまでの間にあるタイルをまとめて動かすと、逆順に戻す操作なども効率的にできます。

- **ゴールイメージを最初に作る**
    - 最後に並べるべき数字の配置（ゴールイメージ）を頭に入れてから動かすと迷いが少なくなります。
    - 「空きを最後の行末に置いておき、1→2→3…をグループ化して配置する」ように考えるとスムーズです。

- **行・列を部分的に完成させる**
    - まず「1行目」だけを正しく揃え、次に「2行目」を揃えるなど、上から順に完成させていく手法がオススメです。
    - ただし、縦に空きを持ってくる際に一時的に1行目が崩れる場合もあるため、詰まったらシャッフルを活用しましょう。
